machine:
  python:
    version: 2.7.3
  # Add AWS deploy-only creds
  environment:
    AWS_ACCESS_KEY_ID:
    AWS_SECRET_ACCESS_KEY:
    AWS_DEFAULT_REGION: us-east-1
    PRODUCTION_STACK_ID:
    PRODUCTION_APP_ID:
    STAGING_STACK_ID:
    STAGING_APP_ID:
dependencies:
  override:
    - pip install -r requirements/test.txt
  post:
    - sed -i -e "s:{{project_name}}:expademo:g" fabfile.py
database:
  override:
    - createuser -d skeleton
    - createdb skeleton_test
test:
  override:
    - coverage run --source='./project_name/' project_name/manage.py test -v3
    - pylint -E fabfile.py
  post:
    - coverage html -d $CIRCLE_ARTIFACTS
    - pylint -d R0914,R0913,C0103,W1401,C0301,R0915,W0703,R0912,C0111,C0302,W0511,C0303 -f html fabfile.py > $CIRCLE_ARTIFACTS/pylint.html
# deployment:
#   production:
#     branch: prd
#     commands:
#       - pip install awscli
#       - ./deploy/deploy_aws.sh $PRODUCTION_STACK_ID $PRODUCTION_APP_ID
#   staging:
#     branch: master
#     commands:
#       - pip install awscli
#       - ./deploy/deploy_aws.sh $STAGING_STACK_ID $STAGING_APP_ID
